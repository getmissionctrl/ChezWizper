# Nix flake development environment
use flake

# Create local directories for development
mkdir -p .direnv/models
mkdir -p .direnv/config

# Set up environment variables for development
export CHEZWIZPER_MODEL_DIR="$PWD/.direnv/models"
export CHEZWIZPER_CONFIG_DIR="$PWD/.direnv/config"

# Development-specific settings
export RUST_LOG="chezwizper=debug"
export RUST_BACKTRACE=1

# Create a development config if it doesn't exist
if [ ! -f "$CHEZWIZPER_CONFIG_DIR/config.toml" ]; then
  cat > "$CHEZWIZPER_CONFIG_DIR/config.toml" << 'EOF'
[audio]
device = "default"
sample_rate = 16000
channels = 1

[whisper]
model = "base"
language = "en"
# Model will be downloaded to .direnv/models/

[ui]
show_notifications = true

[behavior]
auto_paste = true
delete_audio_files = true
EOF
  echo "Created development config at $CHEZWIZPER_CONFIG_DIR/config.toml"
fi

# Helper function to download models to local directory
download_model() {
  ./nix/download-models.sh -d "$CHEZWIZPER_MODEL_DIR" "$@"
}

# Print helpful information
echo "ChezWizper Development Environment"
echo "================================="
echo ""
echo "Model directory: $CHEZWIZPER_MODEL_DIR"
echo "Config directory: $CHEZWIZPER_CONFIG_DIR"
echo ""
echo "Quick commands:"
echo "  download_model base     - Download base model to local dir"
echo "  cargo run              - Run with local config"
echo "  cargo watch -x run     - Run with auto-reload"
echo ""

# Set XDG_CONFIG_HOME to use local config during development
export XDG_CONFIG_HOME="$PWD/.direnv"
